<Page
    x:Class="RyTuneX.Views.ServicesPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">
    <Grid x:Name="ContentArea" Padding="24,14,24,0">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <!-- Summary Cards -->
        <Grid x:Name="SummaryPanel" Grid.Row="0" Margin="0,0,0,16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Total Services Card -->
            <Border Grid.Column="0" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" 
                    CornerRadius="6" Padding="16,12" Margin="0,0,8,0">
                <StackPanel Orientation="Horizontal" Spacing="12">
                    <FontIcon Glyph="&#xE9F5;" FontSize="24" Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"/>
                    <StackPanel>
                        <TextBlock x:Name="TotalServicesText" Text="0" FontSize="18" FontWeight="SemiBold"/>
                        <TextBlock x:Uid="ServicesPage_TotalServices" FontSize="12" Opacity="0.7"/>
                    </StackPanel>
                </StackPanel>
            </Border>

            <!-- Running Services Card -->
            <Border Grid.Column="1" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" 
                    CornerRadius="6" Padding="16,12" Margin="4,0">
                <StackPanel Orientation="Horizontal" Spacing="12">
                    <FontIcon Glyph="&#xE768;" FontSize="24" Foreground="{ThemeResource SystemFillColorSuccessBrush}"/>
                    <StackPanel>
                        <TextBlock x:Name="RunningServicesText" Text="0" FontSize="18" FontWeight="SemiBold"/>
                        <TextBlock x:Uid="ServicesPage_RunningServices" FontSize="12" Opacity="0.7"/>
                    </StackPanel>
                </StackPanel>
            </Border>

            <!-- Stopped Services Card -->
            <Border Grid.Column="2" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" 
                    CornerRadius="6" Padding="16,12" Margin="8,0,0,0">
                <StackPanel Orientation="Horizontal" Spacing="12">
                    <FontIcon Glyph="&#xE71A;" FontSize="24" Foreground="{ThemeResource SystemFillColorCautionBrush}"/>
                    <StackPanel>
                        <TextBlock x:Name="StoppedServicesText" Text="0" FontSize="18" FontWeight="SemiBold"/>
                        <TextBlock x:Uid="ServicesPage_StoppedServices" FontSize="12" Opacity="0.7"/>
                    </StackPanel>
                </StackPanel>
            </Border>
        </Grid>

        <!-- Search and Filter -->
        <Grid Grid.Row="1" Margin="0,0,0,12">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <AutoSuggestBox x:Name="SearchBox" 
                            PlaceholderText="Search services..." 
                            QueryIcon="Find"
                            TextChanged="SearchBox_TextChanged"/>
            <ComboBox x:Name="FilterComboBox" Grid.Column="1" Margin="8,0,0,0" Width="140"
                      SelectionChanged="FilterComboBox_SelectionChanged">
                <ComboBoxItem Content="All" IsSelected="True"/>
                <ComboBoxItem Content="Running"/>
                <ComboBoxItem Content="Stopped"/>
                <ComboBoxItem Content="Automatic"/>
                <ComboBoxItem Content="Manual"/>
                <ComboBoxItem Content="Disabled"/>
            </ComboBox>
            <Button x:Name="RefreshButton" Grid.Column="2" Margin="8,0,0,0" Click="RefreshButton_Click">
                <FontIcon Glyph="&#xE72C;" FontSize="14"/>
            </Button>
        </Grid>

        <!-- Results Count -->
        <TextBlock x:Name="ResultsText" Grid.Row="2" FontSize="12" Opacity="0.7" Margin="0,0,0,8"/>

        <!-- Column Headers -->
        <Grid x:Name="HeaderGrid" Grid.Row="3" 
              Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}" 
              Padding="12,8" CornerRadius="4" Margin="0,0,0,8">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="1.8*"/>
                <ColumnDefinition Width="0.8*"/>
                <ColumnDefinition Width="0.9*"/>
                <ColumnDefinition Width="1.2*"/>
            </Grid.ColumnDefinitions>
            <Button x:Name="NameHeader" Tag="Name" Click="SortHeader_Click" 
                    Background="Transparent" BorderThickness="0" Padding="0" HorizontalAlignment="Left">
                <TextBlock Text="Service Name" FontWeight="SemiBold" FontSize="13"/>
            </Button>
            <Button x:Name="StatusHeader" Tag="Status" Grid.Column="1" Click="SortHeader_Click" 
                    Background="Transparent" BorderThickness="0" Padding="0" HorizontalAlignment="Center">
                <TextBlock Text="Status" FontWeight="SemiBold" FontSize="13"/>
            </Button>
            <Button x:Name="StartTypeHeader" Tag="StartType" Grid.Column="2" Click="SortHeader_Click" 
                    Background="Transparent" BorderThickness="0" Padding="0" HorizontalAlignment="Center">
                <TextBlock Text="Startup" FontWeight="SemiBold" FontSize="13"/>
            </Button>
            <TextBlock Text="Actions" Grid.Column="3" FontWeight="SemiBold" FontSize="13" HorizontalAlignment="Center" VerticalAlignment="Center"/>
        </Grid>

        <!-- Services List -->
        <Grid Grid.Row="4" Margin="0,0,0,24">
            <ProgressRing x:Name="LoadingRing" IsActive="True" Width="48" Height="48" 
                          HorizontalAlignment="Center" VerticalAlignment="Center"/>
            <ListView x:Name="ServicesListView" 
                      SelectionMode="None"
                      Visibility="Collapsed">
                <ListView.ItemTemplate>
                    <DataTemplate>
                        <Border Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                                CornerRadius="4" Padding="12,10" Margin="0,2">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="1.8*"/>
                                    <ColumnDefinition Width="0.8*"/>
                                    <ColumnDefinition Width="0.9*"/>
                                    <ColumnDefinition Width="1.2*"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon Glyph="{Binding StatusDisplay.Glyph}" FontSize="14" Foreground="{Binding StatusDisplay.Color}" Opacity="0.6"/>
                                    <StackPanel Spacing="2">
                                        <TextBlock Text="{Binding DisplayName}" TextTrimming="CharacterEllipsis" FontSize="13"/>
                                        <TextBlock Text="{Binding Name}" FontSize="11" Opacity="0.5" TextTrimming="CharacterEllipsis"/>
                                    </StackPanel>
                                </StackPanel>
                                <Border Grid.Column="1" Background="{ThemeResource SubtleFillColorSecondaryBrush}" 
                                        CornerRadius="4" Padding="10,4" HorizontalAlignment="Center">
                                    <TextBlock Text="{Binding Status}" FontSize="12" Opacity="0.85" VerticalAlignment="Center"/>
                                </Border>
                                <ComboBox Grid.Column="2" 
                                          SelectedIndex="{Binding StartTypeIndex}"
                                          Tag="{Binding Name}"
                                          SelectionChanged="StartupType_SelectionChanged"
                                          DropDownOpened="StartupType_DropDownOpened"
                                          DropDownClosed="StartupType_DropDownClosed"
                                          HorizontalAlignment="Center"
                                          MinWidth="100"
                                          Padding="8,4">
                                    <ComboBoxItem Content="Automatic"/>
                                    <ComboBoxItem Content="Manual"/>
                                    <ComboBoxItem Content="Disabled"/>
                                </ComboBox>
                                <StackPanel Grid.Column="3" Orientation="Horizontal" HorizontalAlignment="Center" Spacing="4">
                                    <Button Tag="{Binding Name}" 
                                            Click="StartService_Click" 
                                            ToolTipService.ToolTip="Start Service"
                                            Padding="8,6"
                                            IsEnabled="{Binding CanStart}">
                                        <FontIcon Glyph="&#xE768;" FontSize="12"/>
                                    </Button>
                                    <Button Tag="{Binding Name}" 
                                            Click="StopService_Click" 
                                            ToolTipService.ToolTip="Stop Service"
                                            Padding="8,6"
                                            IsEnabled="{Binding CanStop}">
                                        <FontIcon Glyph="&#xE71A;" FontSize="12"/>
                                    </Button>
                                    <Button Tag="{Binding Name}" 
                                            Click="RestartService_Click" 
                                            ToolTipService.ToolTip="Restart Service"
                                            Padding="8,6"
                                            IsEnabled="{Binding CanStop}">
                                        <FontIcon Glyph="&#xE72C;" FontSize="12"/>
                                    </Button>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
        </Grid>
    </Grid>
</Page>
